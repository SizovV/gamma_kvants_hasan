\documentclass[11pt,master,times]{disser}
\usepackage[left=20mm, top=15mm, right=10mm, bottom=20mm, nofoot, nomarginpar]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[english, russian]{babel}
\usepackage{graphicx, multicol}
\usepackage{rotating}
\usepackage{adjustbox}
\usepackage{multirow}
\usepackage{pdfpages}
\usepackage{color}
\usepackage{verbatim}
\usepackage{gensymb}
\usepackage{lineno,hyperref}
\usepackage{amsmath, amssymb}
\usepackage{lscape, textcomp}
\usepackage{cleveref}
\usepackage{color}
\usepackage{upgreek}
\newcommand{\ignore}[1]{}
\graphicspath{pictures/}
\pagestyle{footcenter}
\chapterpagestyle{footcenter}
\setcounter{tocdepth}{2}

%\bibliographystyle{unsrt}

\begin{document}

\pagestyle{empty}
\begin{center}

<<<<<<< HEAD
\noindent  Федеральное государственное бюджетное образовательное учреждение высшего профессионального образования\\
=======
  Федеральное государственное бюджетное образовательное учреждение высшего профессионального образования\\
>>>>>>> d082c9b27f01d1aed7a45394379fe92a1fd38c33

МОСКОВСКИЙ ГОСУДАРСТВЕННЫЙ ТЕХНИЧЕСКИЙ УНИВЕРСИТЕТ \\ 
имени Н.Э.Баумана \\
Факультет Фундаментальных наук\bigskip\\

%Образовательная программа \\
 % «Фак»\\
\vfill


Домашнее задание № 1\\
по курсу «Вычислительная физика»\\
%Тема: «Численные методы решения краевых задач для ОДУ»\\
%\textbf{Вариант 2}\\

%На тему «title»\\
%Название темы на английском  «title»\\
\vfill
\vfill
\begin{flushright}
\begin{tabular}{ll}
Выполнил: & Cизов В.\\
&студент гр. ФН4-72Б \\ 
Проверил:  & доцент, к.физ.-мат.н.       \\
           & Хасаншин Р.Х.
\end{tabular}
\end{flushright}
\vfill
\begin{center}
Москва, $2020$
\end{center}

\end{center}
\pagebreak

\pagestyle{plain}

 %\includepdf[pages={1}]{Titulnyy.pdf}

\tableofcontents
\section{Теоретическая часть}

\subsection{Моделирование траекторий нейтронов и фотонов}

Реализация метода Монте-Карло при решении задач переноса излучения сводится к процессу моделированию траекторий частиц в среде, который состоит из следующих основных этапов:

\begin{enumerate}
\item  \textit{розыгрыша параметров источника;}

\item \textit{ розыгрыша длины свободного пробега;}

\item \textit{ розыгрыша типа взаимодействия;}

\item \textit{ розыгрыша параметров частицы после взаимодействия}.
\end{enumerate}

Рассмотрим более подробно отдельные этапы моделирования распространения незаряженных частиц. 

 \subsubsection{Розыгрыш параметров источника}

Моделирование траектории начинается с определения координат рождения частицы $\vec{r}_{0} $, направления ее движения $\vec{\Omega }_{0} $ и энергии $E_{0} $. Для нормированной на единицу функции распределения источника 
\[\int d \vec{r}\int d \vec{\Omega }\int dE q(\vec{r},E,\vec{\Omega })=1\] 
вероятность появления $\vec{r}_{0} $ в элементе объема $d\vec{r}$:
\begin{equation} \label{GrindEQ__2_} 
P(\vec{r}_{0} \in d\vec{r})=d\vec{r}\iint q(\vec{r},E,\vec{\Omega }) dEd\vec{\Omega }=q(\vec{r})d\bar{r},      
\end{equation} 
а так же условные вероятности попадания $\vec{\Omega }_{0} $ в $d\vec{\Omega }$
\begin{equation} \label{GrindEQ__3_} 
P(\vec{\Omega }_{0} \in d\vec{\Omega }\left|\vec{r}_{0} \right. =\vec{r})=\frac{\int dE q(\vec{r},E,\vec{\Omega })}{\iint q(\vec{r},E,\vec{\Omega }) dEd\vec{\Omega }} d\vec{\Omega }=\frac{q(\vec{r},\vec{\Omega })}{q(\vec{r})} d\vec{\Omega } 
\end{equation} 

и энергии $E_{0} $ в $dE$
\begin{equation} \label{GrindEQ__4_} 
P(E_{0} \in dE\left|\vec{r}_{0} =\vec{r},\vec{\Omega }_{0} =\vec{\Omega }\right. )=\frac{q(\vec{r},E,\vec{\Omega })}{\int dE q(\vec{r},E,\vec{\Omega })} dE=\frac{q(\vec{r},\vec{\Omega },E)}{q(\vec{r},\vec{\Omega })} dE.           
\end{equation} 
Перемножив \eqref{GrindEQ__2_}-\eqref{GrindEQ__4_}, получим 
\begin{equation} \label{GrindEQ__5_} 
P(\vec{r}_{0} \in d\vec{r})P(\vec{\Omega }_{0} \in d\vec{\Omega }\left|\vec{r}_{0} \right. =\vec{r})P(E_{0} \in dE\left|\vec{r}_{0} =\vec{r},\vec{\Omega }_{0} =\vec{\Omega }\right. )=q(\vec{r},E,\vec{\Omega })d\vec{r}dEd\vec{\Omega },       
\end{equation} 
т.е. выбрав последовательно $\vec{r}_{0} ,E_{0} ,\vec{\Omega }_{0} $ из распределений 
\begin{equation} \label{GrindEQ__6_} 
p_{\vec{r}_{0} } (\vec{r})=q(\vec{r}); p_{\vec{\Omega }_{0} } (\left. \vec{\Omega }\right|\vec{r}_{0} )=\frac{q(\vec{r}_{0} ,\vec{\Omega })}{q(\vec{r}_{0} )} ; p_{E_{0} } (\left. E\right|\vec{r}_{0} ,\vec{\Omega }_{0} )=\frac{q(\vec{r}_{0} ,\vec{\Omega }_{0} ,E)}{q(\vec{r}_{0} ,\vec{\Omega }_{0} )} ,        
\end{equation} 
найдем совокупность случайных величин $(\vec{r}_{0} ,E_{0} ,\vec{\Omega }_{0} )$ с распределением $q(\vec{r},\vec{\Omega },E)$. Если переменные в функции источника разделяются (независимые) 
\[q(\vec{r},E,\vec{\Omega })=q_{1} (\vec{r})q_{2} (E)q_{3} (\vec{\Omega }),\] 
 то соответствующие случайные величины моделируются независимо друг от друга. 

Рассмотрим изотропный источник моноэнергетических частиц, равномерно распределенный по круговой подложке радиусом $R$, т.е. все переменные разделяются. В данном случае удобно воспользоваться полярной системой координат. 


В силу симметрии, плотность вероятности вылета частиц из источника на расстоянии  $\rho $ от центра в интервале $d\rho $ будет пропорциональна площади кольца  $f(\rho )d\rho \approx 2\pi \rho d\rho $;
\[f(\rho )=\frac{2\pi \rho }{\int _{0}^{R}2\pi \rho d\rho  } =\frac{2\rho }{R^{2} } .\] 
Следовательно, функция распределения 
\[F(\rho )=\int _{0}^{\rho }f( \rho ')d\rho '=\frac{\int _{0}^{\rho }2 \rho 'd\rho '}{R^{2} } =\frac{\rho ^{2} }{R^{2} } =\gamma .\] 
Применяя метод обратных функций, получаем $F(\rho )=\gamma $ и $\rho =R\sqrt{\gamma } $. 

\noindent Точка вылета частицы для данного $\rho $ равновероятно распределена на промежутке $(0,2\pi )$ по азимутальному углу $\psi $, поэтому $f(\psi )=\frac{1}{2\pi } $ и $F(\psi )=\int _{0}^{\psi }f (\psi ')d\psi '=\frac{\psi }{2\pi } =\gamma $ откуда получаем $\psi =2\pi \gamma $.

Разыграем направление вылета для  изотропного источника   $f(\vec{\Omega }_{0} )d\vec{\Omega }_{0} =\frac{d\vec{\Omega }_{0} }{4\pi } =\frac{d\cos \theta _{0} }{2} \frac{d\psi _{0} }{2\pi } $, т.е. величины $\cos \theta _{0} $ и $\psi _{0} $ распределены независимо и равномерно в интервалах $(-1,+1)$ и $(0,2\pi )$ соответственно. Применяя метод обратных функций, получаем  
\[F(\cos \theta _{0} )=\int _{-1}^{\cos \theta _{0} }f(t)dt =\frac{1}{2} \int _{-1}^{\cos \theta _{0} }dt =\frac{\cos \theta _{0} +1}{2} =\gamma ;\quad \cos \theta _{0} =2\gamma -1.\] 
Вследствие азимутальной симметрии угол $\psi _{0} $ можно разыгрывать по формуле $\psi _{0} =2\pi \gamma $, но на практике экономичнее разыгрывать значения косинуса и синуса этого угла, потому что именно они используются для дальнейших расчетов. С помощью метода исключения косинусы и синусы моделируются как координаты единичного изотропного вектора на плоскости по схеме:
\[1) a=1-2\gamma _{1} ,\quad b=1-2\gamma _{2} ;\] 
2) $d=a^{2} +b^{2} $, если $d>1$, то на 1), иначе -- на 3);
\[3) \cos \psi _{0} =\frac{a}{\sqrt{d} } ;\quad \sin \psi _{0} =\frac{b}{\sqrt{d} } .\] 

В рассмотренном примере все распределения имеют простой вид, что редко встречается на практике, поэтому выбор оптимальных алгоритмов обычно представляет собой не простою задачу.  



\subsection{Розыгрыш длины свободного пробега}

Розыгрыш длины свободного пробега вдоль заданного направления $\vec{\Omega }$ является следующим шагом после выбора параметров источника. Для однородной изотропной среды розыгрыш производим методом обратной функции. Плотность распределения случайной величины $L$ определяется транспортным ядром интегрального уравнения переноса. Поэтому плотность и функцию распределения  длины свободного пробега в направлении $\vec{\Omega }$ можно записать в виде 
\[f_{L} (t)=\Sigma [\vec{r}(t),E]\exp [-\tau (t,E)];\] 
\[F_{L} (t)=1-\exp [-\tau (t,E)],\quad t>0,\] 

где $\vec{r}(t)=\vec{r}'+t\, \vec{\Omega }$; $\tau (t,E)=\int _{\, 0}^{\, t}\Sigma [\vec{r}(t'),E] \, dt'$.

Получим случайную величину $L$ для незаряженной частицы в однородной бесконечной среде, плотность распределения которой равна 
\[f_{L} (x)=\left\{\begin{array}{l} {\Sigma (E)\exp [-\Sigma (E)x],\quad x\ge 0} \\ {0,\quad \quad \quad \quad \, \, \, x<0} \end{array}\right. .\] 
Для этого решаем уравнение
\[\int _{0}^{L}f_{L}  (x)dx=1-\exp [-\Sigma (E)L]=\gamma ,\] 
отсюда 

\noindent $L=-\frac{1}{\Sigma (E)} \ln (1-\gamma )$ или $L=-\frac{1}{\Sigma (E)} \ln \gamma $,

\noindent так как случайные величины $\gamma $ и $1-\gamma $ статистически эквивалентны, то получаем выражение для розыгрыша длины свободного пробега в однородной среде  
\[L=-\ln (\gamma )/\Sigma (E).\] 


\subsection{Розыгрыш типа взаимодействия}

Следующий шаг заключается в розыгрыше типа взаимодействия. Пусть полное поперечное сечение для  $i$- го атома
\[\sigma _{i} =\sum _{\, k=1}^{\, m}\sigma _{ik}  ,\] 
где $\sigma _{ik} $-- парциальное сечение для $k$- го типа взаимодействия с $i$- атомом. Введя дискретную случайную величину $\eta $, принимающую значения от 1 до $m$ с вероятностью $p_{k} =\frac{\sigma _{ik} }{\sigma _{i} } $, т.е. имеющую распределение вида  $\eta =\left(\begin{array}{l} {1\, \quad \, 2\, \; \, \ldots \, \, \; m} \\ {p_{1} \, \, \, p_{2} \; \, \ldots \, \; p_{m} } \end{array}\right)$.  Разыгрываем значения $\eta $ и определяем тип  взаимодействия на $i$-м атоме, по следующей схеме:

\begin{enumerate}
\item  если  $\gamma \le \frac{\sigma _{i1} }{\sigma _{i} } $, то произошло взаимодействие 1-го типа с атомом \textit{k}-го типа;

\item    если  $\gamma >\frac{\sigma _{i1} }{\sigma _{i} } $, то проверяется выполнение следующего неравенства
\[\frac{\sum _{\, k=1}^{\, l}\sigma _{ik}  }{\sigma _{i} } <\gamma \le \frac{\sum _{\, k=1}^{\, l+1}\sigma _{ik}  }{\sigma _{i} } , \eta =l+1.\] 
\end{enumerate}

Если последнее неравенство выполняется при некотором $l$, то полагают, что произошло взаимодействие $l+1$-го типа.

Далее мы будем рассматривать задачу переноса фотонов с учетом следующих типов взаимодействий: рассматривается комптоновское рассеяние, фотоэффект, образование электронно-позитронной пары, когерентное рассеяние и образование фотонейтронов. В таком случае полное сечение взаимодействия фотонов есть сумма сечений упомянутых выше процессов 

$$\Sigma =\sigma _{K} +\sigma _{D} +\sigma _{?} +\sigma _{el} +\sigma _{\gamma ,n} ,$$

Параметры после столкновения включают энергию и направление движения рассеянной первичной частицы, а также тип, число, энергию и направление движения любых вторичных частиц, родившихся при взаимодействии. Эти параметры определяются с помощью ядра столкновений и предполагают использование данных по дифференциальным поперечным сечениям, причем более подробных, чем при выборе типа взаимодействия.

Если, произошел фотоэффект и нас не интересует история фотоэлектрона, то мы переходим к следующему фотону из заданной статистики. Если же произошло комптоновское рассеяние, то мы вынуждены рассматривать историю рассеянного фотона, предварительно определив энергию фотона и направление его движения. При комптоновском рассеянии, фотон с первоначальной энергией $E'$ в результате взаимодействия с электроном передает ему часть энергии и изменяет направление своего движения. Поскольку скорость атомных электронов очень мала по сравнению со скоростью света, то можно считать электрон свободным и покоящимся.


Энергия рассеянного фотона и угол рассеяния связаны формулой $E=E'[1+E'(1-\cos \theta )/mc^{2} ]^{-1} $ Введя обозначения $\alpha =\frac{E}{m_{0} c^{2} } $ и $\alpha '=\frac{E'}{m_{0} c^{2} } $ получим выражение энергии рассеянного фотона в единицах энергии массы покоя электрона
$\alpha =\frac{\alpha '}{1+\alpha '(1-\cos \theta )} $

Рассмотрим выбор энергии и направления движения фотона после комптоновского рассеяния. Из приведенного выше выражения следует, что потеря энергии и косинус угла рассеяния жестко связанны между собой, достаточно разыграть одну из этих величин. Приведем один из возможных алгоритмов, основанный на методе исключения. Плотность распределения   

\noindent энергии после рассеяния $\alpha $ пропорциональна функции 
\[f(x,\alpha ')\sim p(x,\alpha ')=\frac{x}{\alpha '} +\frac{\alpha '}{x} +(\frac{1}{\alpha '} -\frac{1}{x} )(2+\frac{1}{\alpha '} -\frac{1}{x} ),\] 
при $\frac{\alpha '}{1+2\alpha '} <x<\alpha '$,

\noindent следовательно, справедливо соотношение 
\[p(x,\alpha ')\le 1+2\alpha '+\frac{1}{1+2\alpha '} \] 
Величину $\alpha $ определяем с помощью метода исключения:

\noindent а) выберем два значения $\gamma _{1} $, $\gamma _{2} $ случайной величины  $\gamma $ равномерно распределенной на интервале $(0,1)$;

\noindent б) вычислим $x=\frac{\alpha '(1+2\alpha '\gamma _{1} )}{1+2\alpha '} $, и отсюда находим $p(x,\alpha ')$

\noindent в) если при этом $\gamma _{2} \left(1+2\alpha '+\frac{1}{1+2\alpha '} \right)<p(x,\alpha ')$, то $\alpha =x$, иначе снова выполняется п. а) и т. д. 

\noindent После определения энергии, определяют направление движения после

\noindent взаимодействия. Азимутальный угол рассеяния выбирается из равномерного распределения по схеме приведенной выше, а косинус угла рассеяния рассчитывается по формуле  $\mu _{s} =\cos \theta _{s} =1-1/\alpha +1/\alpha '$.

 В декартовой системе координат новое направление движения задается тремя направляющими косинусами

$\vec{\Omega }=\vec{i}\cos x+\vec{j}\cos y+\vec{k}\cos z$ или  $\vec{\Omega }=\vec{i}\omega _{1} +\vec{j}\omega _{2} +\vec{k}\omega _{3} $

\noindent Формулы перехода от $\vec{\Omega }'$ к $\vec{\Omega }$ выглядят следующим образом:
$$\omega _{3} =\omega '_{3} \mu _{s} +\sqrt{(1-\mu _{s}^{2} )[1-(\omega '_{3} )^{2} ]} \cos \psi _{s} ;$$
$$\omega _{2} =\frac{\omega '_{2} (\mu _{s} -\omega '_{3} \omega _{3} )+\omega '_{1} \sin \psi \sqrt{(1-\mu _{s}^{2} )[1-(\omega '_{3} )^{2} ]} }{1-(\omega '_{3} )^{2} } ;$$
$$\omega _{1} =\frac{\omega '_{1} (\mu _{s} -\omega '_{3} \omega _{3} )-\omega '_{2} \sin \psi \sqrt{(1-\mu _{s}^{2} )[1-(\omega '_{3} )^{2} ]} }{1-(\omega '_{3} )^{2} } ;$$ 
Разыгрывая длину свободного пробега после первого столкновения

$$L_{2} =-\frac{\ln \xi }{\Sigma (E_{2} )} $$ находим точку $\vec{r}_{2} =\vec{r}_{1} +L_{2} \vec{\Omega }_{2} $

Координаты точки $(n+1)$-го взаимодействия находятся в декартовой системе координат по формулам:
$$x_{n+1} =x_{n} +L_{n+1} \omega _{1,n} ;$$ 
$$y_{n+1} =y_{n} +L_{n+1} \omega _{2,n} ;$$ 
$$z_{n+1} =z_{n} +L_{n+1} \omega _{3,n} .$$ 

Зная энергию рассеянного фотона можно вычислить сечение его последующего взаимодействия с веществом (полное или комптоновского взаимодействия)

В процессе комптоновского взаимодействия фотоны рассеиваются под всевозможными углами $(0 \le \theta_{s} \le \pi )$, и дифференциальное угловое сечение рассеяния (т.е. отнесенное к единице телесного угла) при этом, рассчитывается на основании квантовой электродинамики и выражается формулой Клейна-Нишины-Тамма:

\begin{equation} \label{GrindEQ__16_} 
\sigma _{C} (\alpha ',\theta _{s} )=\frac{Zr_{e} ^{2} }{2} [1+\alpha '(1-\mu _{s} )]^{-2} \left[1+\mu _{s} ^{2} +\frac{(\alpha ')^{2} (1-\mu _{s} )^{2} }{1+\alpha '(1-\mu _{s} )} \right] 
\end{equation} 
где $Z$- атомный номер материала среды;

\noindent $r_{e} $-классический радиус электрона.

Для фотонов высоких энергий наблюдается преимущественное рассеяние вперед, а с уменьшением энергии дифференциальное сечение имеет все более плавную угловую зависимость, и в пределе при $\alpha '\to 0$ из выражения \eqref{GrindEQ__16_} получаем классическую формулу Томсона (см${}^{2}$/ср):
\[\sigma _{s} (\theta _{s} )=Zr_{e} ^{2} \left(1+\cos ^{2} \theta _{s} \right)/2.\] 

Интегрирование формулу \eqref{GrindEQ__16_} по телесному углу дает выражение (согласно теории Клейна-Нишины-Тамма) для полного сечение комптоновского взаимодействия фотонов со свободными электронами имеет вид
\begin{equation} \label{GrindEQ__17_} 
\sigma _{C} (\alpha ')=2\pi Zr_{e}^{2} \left\{\frac{1+\alpha '}{\alpha '^{2} } \left[\frac{2(1+\alpha ')}{1+2\alpha '} -\frac{\ln (1+2\alpha ')}{\alpha '} \right]+\frac{\ln (1+2\alpha ')}{2\alpha '} -\frac{1+3\alpha '}{(1+2\alpha ')^{2} } \right\},  
\end{equation} 


\subsection{Локальная оценка потока}  


\subsubsection{Оценки функционалов в методе Монте-Карло }


Рассмотрим, какие случайные величины (оценки) следует ввести в шестимерном фазовом пространстве траекторий $\Gamma $, чтобы их математические ожидания равнялись конкретному функционалу.

 Пусть необходимо рассчитать линейный функционал
\begin{equation} \label{GrindEQ__1_} 
I_{g} =(\psi, g)=\iint \limits _{\Gamma }\psi (\vec{r},\vec{E}) g(\vec{r},\vec{E})d\vec{r}d\vec{E}, 
\end{equation} 
где $g(\vec{r}, \vec{E})$ -- функция отклика детектора, $\psi (\vec{r},\vec{E})$ -- плотность столкновений, удовлетворяющая интегральному уравнению
\[\psi (\vec{r},\vec{E})=q_{1} (\vec{r},\vec{E})+\iint K(\vec{r}',\vec{E}';\vec{r},\vec{E})\psi (\vec{r}',\vec{E}') d\vec{r}'d\vec{E}'.   (*)\] 

 Далее предполагается, что любая траектория в рассматриваемых процессах случайного блуждания с вероятностью единица заканчивается после конечного числа соударений.

 Построим процесс случайных блужданий (цепь Маркова) с параметрами $p_{1} (x)$; $p(x',x)$; $p(x)$, удовлетворяющий следующим условиям 
\[\left. \begin{array}{l} {p_{1} (x)\ne 0,\;\, \text{при} \; \, q_{1} (x)\ne 0;} \\ {p(x',x)\ne 0,\;\, \text{при} \; \,  K(x',x)\ne 0;\quad } \\ {p(x)\ne 0,\;\, \text{при} \; \,  g(x)\ne 0.} \end{array}\right\}\] 

Таким образом, траектории должны начинаться в тех точках, где $q_{1} (x)\ne 0$, а при переходе $x'\to x$ попадать в те точки где $K(x',x)\ne 0$.

\textbf{\textit{Определение.}} \textbf{\textit{Марковский процесс}}, процесс без последствий, -- случайный процесс, эволюция которого после любого заданного момента времени $t$ не зависит от эволюции предшествующей $t$, при условии, что значение процесса в этот момент фиксировано (короче: «будущее» и «прошлое»  процесса не зависят друг от друга при известном «настоящем»)


\textbf{\textit{Определение.}} \textbf{\textit{Марковская цепь}} - марковский процесс, с конечным или счетным множеством состояний.


\subsubsection{Оценка по столкновениям}
 Такая оценка рассчитывается во всех точках траектории $\alpha =(x_{1} ,\ldots ,x_{k} )$ и имеет вид 
\begin{equation} \label{GrindEQ__2_} 
\eta (\alpha )=\sum\limits_{m=1}^{k}W_{m}  (\alpha )g(x_{m} ),       
\end{equation} 

где $W_{m} $-- вес частицы при \textit{m}-м столкновении, определяется из выражения
\begin{equation} \label{GrindEQ__3_} 
W_{m} (\alpha )=\frac{q_{1} (x_{1} )}{p_{1} (x_{1} )} W(x_{1} ,x_{2} )\cdots W(x_{m-1} ,x_{m} ) 
\end{equation} 
где  $W(x',x)=\left\{\begin{array}{l} {K(x',x)/p(x',x),\quad p(x',x)\ne 0\, ;} \\ {0,\quad \quad \quad \quad \quad \quad \quad p(x',x)=0\, .} \end{array}\right. $

В теории метода Монте-Карло доказано, что $M\eta (\alpha )$ -- математическое ожидание случайной величины $\eta (\alpha )$ является несмещенной оценкой функционала $I_{g} =(\psi ,g)$.

\textbf{\textit{Определение}}. \textbf{\textit{Несмещенная оценка}} -- статистическая оценка, математическое ожидание которой совпадает с оцениваемой величиной. 

\textbf{\textit{Определение}}. Если при расчете по методу Монте-Карло точно моделируются реальные вероятностные законы, то такой способ расчета называется аналоговым.
https://www.overleaf.com/project/5e46ee5bfc89430001f9ea15
При аналоговом моделировании траектории частиц и при отсутствии деления в реакциях взаимодействия, учитывая, что $p_{1} (x)=q_{1} (x)$; $p(x',x)=K(x',x)$; $p(x)=\Sigma _{a} (x)/\Sigma (x)$, выражение для случайной величины $\eta (\alpha )$ принимает следующий вид\textbf{\textit{}}
\begin{equation} \label{GrindEQ__4_} 
\eta (\alpha )=\sum _{\, m=1}^{\, k}g(x_{m} ) .      
\end{equation} 

Если, например, необходимо определить число реакций с сечением $\Sigma _{i} (x)$ в некотором объеме $V$, тогда функция отклика детектора
\[g(x)=\upsilon _{V} (x)\cdot \frac{\Sigma _{i} (x)}{\Sigma (x)} ,\] 

где $\upsilon _{V} (x)$-- индикаторная функция объема $V$, которая имеет вид 
\[\upsilon _{V} (x)=\left\{\begin{array}{l} {1,\quad x\in V} \\ {0,\quad x\notin V} \end{array}\right. .\] 

Следовательно, выражение для оценки $\eta (\alpha )$ принимает вид
\begin{equation} \label{GrindEQ__5_} 
\eta (\alpha )=\sum _{m=1}^{k}\frac{\Sigma _{i} (x_{m} )}{\Sigma (x_{m} )} \upsilon _{V} (x_{m} ) .     
\end{equation} 

\subsubsection{Локальная оценка потока}

Рассмотренная выше оценка $\eta (\alpha )$ дает средние значения для функций $\psi (\vec{r},E)$, $\varphi (\vec{r},E$) и функционалов от них по всей области регистрации частиц. Если градиент поля излучения достаточно велик, то чтобы уменьшить погрешность, связанную с усреднением, размеры области приходится уменьшать. Действительно детектор малых размеров практически не возмущает поле излучения, но обладает малой эффективностью, поэтому уменьшается вероятность попадания частицы в данную область, следовательно, увеличивается статистическая погрешность оценки. В таких случаях часто прибегают к локальным оценкам, позволяющим стягивать область детектирования в точку.

 Рассмотрим, для простоты, распространение частиц в среде без размножения и поглощения, так как эти реакции учитываются с помощью весовых множителей. Пусть требуется оценить плотность потока частиц в точке фазового пространства $x^{*} =\{ \vec{r}^{*} ,E^{*} ,\vec{\Omega }^{*} \} $. Подставим эту точку в уравнение для плотности столкновений, прировняв для упрощения выражения $q_{1} (x^{*} )=0$: 
\begin{equation} \label{GrindEQ__6_} 
\psi (x^{*} )=\int K(x',x^{*} )\,  \psi (x')dx'.     
\end{equation} 

 Поделив обе части выражения \eqref{GrindEQ__6_} на $\Sigma _{s} (x^{*} )$, получим
\begin{equation} \label{GrindEQ__7_} 
\varphi (x^{*} )=\int \frac{K(x',x^{*} )}{\sum _{s} (x^{*} )} \,  \psi (x')dx'.     
\end{equation} 
Формально функция $\varphi (x^{*} )$ представлена в виде функционала от плотности столкновений $\psi (x')$ с функцией отклика детектора, равной
$g(x',x^{*} )=\dfrac{K(x',x^{*} )}{\sum _{s} (x^{*} )}$
Для расчета $\varphi (x^{*} )$ выберем оценку по столкновениям \eqref{GrindEQ__2_} и получим что математическое ожидание случайной величины 
\begin{equation} \label{GrindEQ__8_} 
\eta _{1} (\alpha )=\sum _{m=1}^{k}\frac{W_{m} (\alpha )}{\sum _{s} (x^{*} )} K(x_{m} ,x^{*} )  
\end{equation} 

равно плотности потока рассеянного излучения в точке $x^{*} $. Величину $W_{m} $-часто называют весом \textit{m-}го рассеяния. Она представляет собой условную вероятность «выживания» частицы испытавшей рассеяния в точках $(x_{1} ,\ldots ,x_{m} )$.  Определение плотности потока нерассеянного излучения в точке $x^{*} $, т.е. величины  $q_{1} (x^{*} )/\sum_{s} (x^{*} )$, как правило, не представляет особого труда и вычисляется аналитически с использованием выражения для источника первых столкновений 
$q_{1} (\vec{r}^{*} ,\vec{E})=\int d\vec{r} 'q(\vec{r}',\vec{E})\cdot T(\vec{r}',\vec{r}^{*} \left|\vec{E}\right. ).$ 

 Ядро $K(x_{m} ,x^{*} )$ содержит $\delta $-функцию, для устранения которой достаточно проинтегрировать \eqref{GrindEQ__7_} по некоторой области направлений $\Delta \vec{\Omega }_{i}^{*} $. Для локальной оценки плотности потока рассеянных фотонов (без учета когерентного рассеяния), движущихся в интервале $\Delta \vec{\Omega }_{i}^{*} $ с энергией в интервале $\Delta E_{i}^{*} $, в точке $\vec{r}^{*} $ окончательное выражение имеет вид   
\begin{equation} \label{GrindEQ__9_} 
\eta _{1} (\alpha )=\sum _{m=1}^{k}W_{m}  (\alpha )\frac{\exp [-\tau (\vec{r}_{m} ,\vec{r}^{*} ,E_{m}^{*} )]}{(\vec{r}_{m} -\vec{r}^{*} )^{2} } \frac{\sigma _{C} (\vec{r}_{m} ,E_{m} \to E_{m}^{*} ,(\vec{\Omega }_{m} \cdot \vec{\Omega }_{m}^{*} ))}{\sigma _{C} (\vec{r}_{m} ,E_{m} )} \Delta (E_{m}^{*} ,\Delta E_{i}^{*} )\Delta (\vec{\Omega }_{m}^{*} ,\Delta \vec{\Omega }_{i}^{*} ),  
\end{equation} 
где $\tau (\vec{r}_{m} ,\vec{r}^{*} ,E_{m}^{*} )=\int _{\, }^{\vec{r}_{m} \to \vec{r}^{*} \, }\Sigma (\vec{r}''(t ,E_{m}^{*} ))dt$ -- оптическое расстояние между точками $\vec{r}_{m} $ и $\vec{r}^{*} $ для частицы с энергией $E_{m}^{*} $;
\[\Delta (x,\Delta x)=\left\{\begin{array}{l} {1,\quad x\in \Delta x\, ;} \\ {0,\quad x\notin \Delta x\, ;} \end{array}\right. \] 
$\sigma _{C} (\vec{r}_{m} ,E_{m} \to E_{m}^{*} ,(\vec{\Omega }_{m} \cdot \vec{\Omega }_{m}^{*} ))$, $\sigma _{C} (\vec{r}_{m} ,E_{m} )$ -- дифференциальное угловое сечение рассеяния и интегральное (полное) сечения комптоновского рассеяния.

\noindent Выражение \eqref{GrindEQ__9_} представляет собой локальную оценку плотности потока частиц. Если точка $\vec{r}^{*} $ не принадлежит области переноса излучения, то такая оценка имеет конечную дисперсию. В общем случае ее дисперсия расходится из-за множителя $1/(\vec{r}_{m} -\vec{r}^{*} )^{2} $. Это не является препятствием для ее использования в методе Монте-Карло, поскольку существования математического ожидания обеспечивает действие закона больших чисел. Сходимость среднего арифметического $\bar{\eta }_{N} $ (\textit{N}- число историй) имеет порядок $N^{-1/3} $, а не $N^{-1/2} $, как это имеет место при конечной дисперсии. Иногда возможно появление выбросов в результатах расчетов, связанных с близостью некоторых точек столкновения к точке детектирования $\vec{r}^{*} $.

Математическое ожидание случайной величины $\eta _{1} (\alpha )$ равно плотности потока рассеянного излучения в точке $x^{*} $
\begin{equation} \label{GrindEQ__8_} 
M\eta _{1} (\alpha )=\frac{1}{N} \sum _{l=1}^{N}\eta _{l}  (\alpha _{l} )=\varphi (x^{*} ),     
\end{equation} 
где \textit{N }-- статистика (число усредняемых траекторий) 

Локальная оценка не позволяет рассчитывать угловую плотность потока в точке $\vec{r}^{*} $ непосредственно в заданном направлении $\vec{\Omega }^{*} $. Этого недостатка лишена двойная локальная оценка, функцию отклика детектора для которой берут в виде
\begin{equation} \label{GrindEQ__10_} 
g_{1} (x',x^{*} )=(\int K(x',x'')K(x'',x^{*} ) \, dx'')/\sum _{s} (x^{*} ).       
\end{equation} 
Поясним смысл этой оценки. Если при локальной оценке производится, по существу, суммирование в точке детектирования виртуальных вкладов нерассеяного излучения непосредственно от точек столкновения, то при двойной локальной оценке суммируются виртуальные вклады в точке детектирования через промежуточную точку рассеяния.

 Интеграл в выражении \eqref{GrindEQ__10_} берется по лучу $\vec{r}\; ''(t)=\vec{r}^{*} -\vec{\Omega }^{*} t,\quad t>0.$ Его можно оценить по одному случайному узлу $\vec{\rho }''$, который можно положить равным $\vec{\rho }''=\vec{r}^{*} -\vec{\Omega }^{*} L^{*} $, где $L^{*} $-- случайная длина свободного пробега из $\vec{r}^{*} $ в направлении обратном $\vec{\Omega }^{*} $. Математическое ожидание случайной величины 
\begin{equation} \label{GrindEQ__11_} 
\eta _{2} (\alpha )=\sum _{m=1}^{k}W_{m} (\alpha )g_{1} (x_{m} ,x^{*} )  
\end{equation} 

равно $M[\eta _{2} (\alpha )]=\varphi (x^{*} )-\varphi _{1} (x^{*} )-\varphi _{0} (x^{*} )$,

\noindent где $\varphi _{0} (x^{*} )$, $\varphi _{1} (x^{*} )$ -- плотность потока нерассеянного и однократно рассеянного излучения соответственно.



\textbf{Методы получения случайных чисел с заданным распределением}

Получения случайных чисел с заданным распределением называют \textit{розыгрышем} значений случайной величины.  

Пусть случайная величина $\xi $, определена в интервале $(a,\, b)$ и имеет плотность распределения $f(x)$.  \textit{Выборкой} из плотности $f(x)$ называется такая последовательность чисел $t_{1} ,\, t_{2} ,\ldots (-\infty <t_{i} <+\infty )$, что:
$1) p(a<t_{i} \le b)=\int _{\, a}^{\, b}f(x) dx,  (-\infty \le a<b\le +\infty );$

$2)p(a<t_{i_{1} } ,\ldots ,t_{i_{n} } \le b)=\left[\int _{\, a}^{\, b}f(x) dx\right]^{n} $,  при условии, что все $i_{1} ,\ldots ,i_{n} $ различны. Наиболее распространенный способ получения таких последовательностей является использование последовательности чисел $\gamma _{1} ,\, \gamma _{2} ,\ldots $ представляющих собой выборочные значения случайной величины $\gamma $ равномерно распределенной на отрезке $[0,1]$. Такие числа представляют собой выборку из плотности распределения 
$f(x)=\left\{\begin{array}{l} {1,\quad x\in [0,1]} \\ {0,\quad x\notin [0,1]} \end{array}\right. .$

\subsubsection{Метод обратных функций}

Пусть случайная величина $\xi $, определена в интервале $(a,\, b)$ и имеет плотность распределения $f(x)>0$, $F(x)$- функция распределения. 

Докажем, что выборочное значение $t$ случайной величины $\xi $, можно найти из уравнения

\noindent $F(t)=\int _{\, a}^{\, t}f(x)\,  dx=\gamma $ или $t=F^{-1} (\gamma )$,  \eqref{GrindEQ__1_}

\noindent где $F^{-1} $--- обратная  функция.

\noindent Функция $F(x)$ строго возрастает в интервале $(a,\, b)$ от $F(a)=0$ до $F(b)=1$, поэтому уравнение \eqref{GrindEQ__1_} имеет единственный корень при каждом $\gamma $. При этом справедливо равенство вероятностей
\[P\{ x<t<x+dx\} =P\{ F(x)<\gamma <F(x+dx)\} .\] 
Так как случайная величина $\gamma $ равномерно распределена в интервале $(0,1)$, 

\noindent то вероятность того, что ее значение окажется внутри интервала  $(F(x),F(x+dx))$, равна длине этого интервала
\[P\{ x<t<x+dx\} =F(x+dx)-F(x)=f(x)dx.\] 
Следовательно, выборочное значение $t$ случайной величины $\xi $, имеет плотность распределения $f(x)$. Что и требовалось доказать.

Если $\gamma _{1} ,\, \gamma _{2} ,\ldots $ последовательность независимых чисел равномерно распределенных на промежутке $(0,1)$, то числа $t_{i} =F^{-1} (\gamma _{i} ),\quad i=1,\, 2,\ldots $ представляют собой выборку  из плотности распределения $f(x)$ для  $\xi =F^{-1} (\gamma )$.


В более общем случае, когда плотность распределения удовлетворяет условию $f(x)\ge 0$ в интервале $(a,\, b)$, то решением уравнения \eqref{GrindEQ__1_} является $t=\sup x$, при $F(x)<\gamma $.

\noindent \textit{Замечание.} Разыгрывание значений непрерывных случайных величин методом обратных функций требует существования аналитического решения уравнения \eqref{GrindEQ__1_} относительно $t$.

Рассмотрим дискретную случайную величину $\xi $, принимающую значения $x_{i} $ с вероятностями $p_{i} \; (\sum _{\, i}p_{i} =1) $. Выбор значения величины $\xi $ определим как и ранее  $t=\sup x_{i} $, при $F(x_{i} )<\gamma $. 

Значению $\gamma $, удовлетворяющему неравенству 
$\sum\limits_{i=0}^{j}p_{i}  <\gamma \le \sum\limits_{i=1}^{j+1}p_{i}  ,\; p_{0} =0,$ 
соответствует значение $\xi =x_{j+1} ,\; j=0,\, 1,\ldots $

\noindent Действительно, если обозначить интервал между $F(x_{j} )$ и $F(x_{j+1} )$ через $\Delta _{j+1} $, тогда $p\, (\xi =x_{j+1} )=p\, (\gamma \in \Delta _{j+1} )$. 

\subsubsection{Метод равновероятных интервалов (табличный метод)}


Табличный метод основан на замене моделируемой случайной величины $\xi $ дискретной случайной величиной $\xi _{1} $, принимающей с равной вероятностью значения $x_{i} \; (i=1,\ldots ,n)$. До начала основного расчета составляется таблица из $N$ равновероятных значений $x_{i} $ случайной величины $\xi _{1} $, функция распределения которой аппроксимирует функцию распределения случайной величины $\xi $. Для этого решается уравнение $$F(x_{i} )=\int _{\, -\infty }^{\, x_{i} }f(x)\, dx=(2i-1)/(2N),\quad i=1,\, \ldots ,N$$ и строится таблица значений $i$ и соответствующих значений $x_{i} $. После этого для определения выборочного значения случайной величины $\xi _{1} $ достаточно получить случайное число $i$ принимающее с равной вероятностью значения от 1 до $N$, и выбрать из таблицы $x_{i} $.

\subsubsection{Метод исключения}

Метод исключения, так же как и метод равновероятных интервалов, свободен от недостатков метода обратных функций, связанных с необходимостью получения аналитического решения. Метод исключения, так же как и метод равновероятных интервалов, свободен от недостатков метода обратных функций, связанных с необходимостью получения аналитического решения. Кроме того, он не требует и предварительного расчета таблиц.


Рассмотрим ограниченную на отрезке $[a,b]$ плотность распределения $f(x)$. Пусть $M=\sup f(x)$ и $f_{1} (x)=f(x)/M$, так что $0\le f_{1} (x)\le 1$ (рис. 3). Используя пару равномерно распределенных на отрезке $[0,1]$  независимых случайных чисел $(\gamma _{1} ,\, \gamma _{2} )$, найдем координаты случайной точки $Q=\{ a+\gamma _{1} (b-a),\, \gamma _{2} \} $, лежащей в прямоугольнике с основанием $(b-a)$ и высотой 1. Если эта точка окажется под кривой $f_{1} (x)$, т. е. если $\gamma _{2} <f_{1} [a+(b-a)\, \gamma _{1} ]$, то $t=a+(b-a)\, \gamma _{1} $, принимается в качестве значения случайной величины  с плотностью распределения $f(x)$. В противном случае пара $(\gamma _{1} ,\, \gamma _{2} )$ отбрасывается, выбирается следующая пара $(\gamma _{3} ,\, \gamma _{4} )$ и все повторяется. Вычисленные по такому алгоритму значения $t$ распределены с условной плотностью вероятности 
$f(t\left|\gamma _{2} \right. <f_{1} (t))=\int _{\, 0}^{\, f_{1} (t)}g(t\left|\gamma _{2} \right. )d\gamma _{2}  \cdot \left[\int _{\, a}^{\, b}\left(\int _{\, 0}^{\, f_{1} (t)}g(t\left|\gamma _{2} \right. )d\gamma _{2}  \right) dt\right]^{-1}.$  Учитывая, что совместная плотность распределения  $g(t,\gamma _{2} )$ имеет вид 

$$g(t,\gamma _{2} )=\left\{\begin{array}{l} {1/(b-a),\quad t\in [a,b],\quad \gamma _{2} \in [0,1]} \\ {0,\quad \quad \quad \quad t\notin [a,b],\quad \gamma _{2} \notin [0,1]} \end{array}\right.$$

Условная плотность распределения $g(t\left|\gamma _{2} \right. )$ совпадает с выражением для $g(t,\gamma _{2} )$, поэтому окончательно получаем 
$$\begin{array}{l} {f(t\left|\gamma _{2} \right. <f_{1} (t))=1/(b-a)\int _{\, 0}^{\, f_{1} (t)}d\gamma _{2}  \cdot \left[1/(b-a)\int _{\, a}^{\, b}dt\left(\int _{\, 0}^{\, f_{1} (t)}d\gamma _{2}  \right) \right]^{-1} =} \\ {=f_{1} (t)\left[\int _{\, a}^{\, b}f_{1} (t) dt\right]^{-1} =f(t)} \end{array},$$
что и требовалось доказать.



\section{Задание}

Плоский изотропный источник $\gamma$-квантов с энергиями $E_0$ = 3 МэВ в виде эллипса накрыт шайбой. Геометрические центры основания эллипса и шайбы совпадают. Радиус шайбы $R$ = 30 см, высота шайбы $H$ = 10 см. Полуоси эллипса равны $a$= 10 см и $b$=30 см.

\begin{enumerate}
    \item Построить точки рождения частиц и нарисовать «ёжика» каждая игла, которого представляет собой отрезок соединяющий точку рождения $\gamma$-кванта с точкой его первого взаимодействия.
    \item Методом локальной оценки потока вычислить распределения плотности потока рассеянных квантов вдоль оси симметрии задачи, образующей цилиндра. %и вдоль диаметров верхнего основания параллельных .
\end{enumerate}

\newpage

\section{Результаты вычислений}
\subsection*{Симуляции вылета $\gamma$-квантов}


\begin{figure}[h]
\center{\includegraphics[width=1\linewidth]{500_raspr.eps}} 
\caption{Распределение точек на заданой поверхности. Вычисления проходили для 500 квантов.}
\label{ris:als}
\end{figure} 

\newpage


\begin{figure}[h!]
\begin{minipage}[]{0.47\linewidth}
\center{\includegraphics[width=1\linewidth]{Ezhik1.eps}} 
\end{minipage}
\hfill
\begin{minipage}[]{0.47\linewidth}
\center{\includegraphics[width=1\linewidth]{Ezhik2.eps}} 
\end{minipage}
\caption{Изображения вылета квантов из заданной поверхности в заданный объём. Вычисления проходили для 500 квантов.}
\label{ris:als}
\end{figure} 



\begin{figure}[h!]
\begin{minipage}[]{0.47\linewidth}
\center{\includegraphics[width=1\linewidth]{Figure_3.3.eps}} \\b) Кривые полученные при $n=50$
\end{minipage}
\hfill
\begin{minipage}[]{0.47\linewidth}
\center{\includegraphics[width=1\linewidth]{Figure_3.2.eps}} a) Кривые полученные при $n=50$\\
\end{minipage}
\hfill
\begin{minipage}[]{0.47\linewidth}
\center{\includegraphics[width=1\linewidth]{Figure_3.1.eps}} \\b) Кривые полученные при $n=50$
\end{minipage}
\hfill
\begin{minipage}[]{0.47\linewidth}
\center{\includegraphics[width=1\linewidth]{Figure_3.4.eps}} \\b) Кривые полученные при $n=100$
\end{minipage}
\caption{Изображения взаимодействия квантов со средой после вылета из заданной поверхности в заданный объём}
\label{ris:als}
\end{figure}

\newpage

\begin{figure}[h!]
\begin{minipage}[]{1\linewidth}
\center{\includegraphics[width=1\linewidth]{10000_points_center.eps}} a) Распределение относительно цента симметрии циллиндра(шайбы)
\end{minipage}
\vfill
\begin{minipage}[]{1\linewidth}
\center{\includegraphics[width=1\linewidth]{10000_points_side.eps}} б) Распределение относительно края циллиндра(шайбы) 
\end{minipage}
\caption{Изображения вылета квантов из заданной поверхности в заданный объём. Вычисления проводились при 10000 точек.}
\label{ris:als}
\end{figure} 

\newpage

\begin{figure}[h!]
\begin{minipage}[]{1\linewidth}
\center{\includegraphics[width=1\linewidth]{100000_points_center1.eps}} a) Распределение относительно цента симметрии циллиндра(шайбы)
\end{minipage}
\vfill
\begin{minipage}[]{1\linewidth}
\center{\includegraphics[width=1\linewidth]{100000_points_side1.eps}} б) Распределение относительно края циллиндра(шайбы) 
\end{minipage}
\caption{Изображения вылета квантов из заданной поверхности в заданный объём. Вычисления проводились при 100000 точек.}
\label{ris:als}
\end{figure} 



\newpage

\section{Вывод}
Было построена симуляция вылета $\gamma$-квантов с поверхности эллипса, в заданный объём (шайбу). 

По результатам локальной оценки потока, можно сделать вывод, что вклад квантов малых энергий уменьшается при увеличении высоты местоположения детектора. Так же стоит отметить, что вклад квантов высоких энергий относительно вклада квантов малых энергий всегда больше, вне зависимости от местоположения детектора.

\newpage
\section{Приложение}
\subsection{Программа в c++}

\footnotesize
\begin{verbatim}
#include <...>
using namespace std;
double DoubleRand (double _max, double _min){
    return _min + double (rand ()) / RAND_MAX * (_max - _min);
}

double fun_ellips (double y, double b, double z, double c, double a){
    return sqrt(1 - pow(y/b, 2)- pow(z/c, 2) ) * a;
}

double fun_cirk(double x, double b){
    return sqrt(b*b-x*x);
}

double Scat_diff(double alpha, double alpha_sh){
    double phi_rcos = 1 - 1 / alpha + 1 / alpha_sh;
    double Sech_d = 0.5 * pow(1 + alpha_sh * (1 - phi_rcos), -2) * (1 + pow(phi_rcos, 2) + (pow(alpha_sh*(1 - phi_rcos), 2))
            / (1 + alpha_sh * (1 - phi_rcos)));
    return 13*0.511*0.511/2*Sech_d;
}

double Scat_int(double alpha){
    double pi = 3.141592653589793;
    return 2*pi*13*0.511*0.511* (1+alpha/(alpha*alpha)*(2*(1+alpha)/(1+2*alpha)-log(1+2*alpha)/alpha)+log(1+2*alpha)
    /(2*alpha)-(1+3*alpha)/pow(1+2*alpha, 2)) ;
}

double kompron_scattering(double energy){
    return -0.01061544616*pow(energy, 3)+0.0658795422219*pow(energy, 2)-0.1388152190602*pow(energy, 1)+0.1431159775481;
}

double total_scat(double energy){
    return 0.050587765 * pow(energy, -0.901791187);
}

double rasst_d(double a,double b,double c){
    double rast = pow(a,2)+pow(b,2)+pow(c,2);
    //cout<<rast<<"\t"<<a<<"\t"<<b<<"\t"<<c<<endl;
    while(rast < 1){
        //cout<<rast<<"\t";
        a-=0.5, b-=0.5, c-=0.5;
        rast = pow(a,2)+pow(b,2)+pow(c,2);
    }
    return rast;
}


double Probeg(double gamma, double energy){
    double pho = 2.6989;
    return -log(abs(gamma))/(total_scat(energy)*pho);
}

double Monte_karlo1 (double a, double b, double c, double high_cill, int N, double Start_energy){
    vector<vector<vector<double>>> Ellips_Koords;
    Ellips_Koords.resize(N);
    for (auto & Ellips_Koord : Ellips_Koords) {
        Ellips_Koord.resize(100);
        for (auto & j : Ellips_Koord){
            j.resize(3);
        }
    }
    ofstream fout1("data_elips1.txt");

    double pi = 3.141592653589793;
    int i = 0;
    while (i < N-1){
        vector<vector<double>> Scat_dist;
        Scat_dist.resize(30);
        for (auto & Scat_dist : Scat_dist) {
            Scat_dist.resize(20);
        }
        double x = 2 * a * DoubleRand(1, 0) - a, y = 2 * b * DoubleRand(1, 0) - b;
        double z = 2 * c * DoubleRand(1, 0) - c;
        if (((x > 0 and x < fun_ellips(y, b, z, c, a)) or (x < 0 and x > -fun_ellips(y, b, z, c, a))) and
            ((z > 0 and z < fun_ellips(x, a, y, b, c))) and
            ((y > 0 and y < fun_ellips(x, a, z, c, b)) or (y < 0 and y > -fun_ellips(x, a, z, c, b)))) {
            double alpha = Start_energy/0.511;
            Ellips_Koords[i][0][0] = x;
            Ellips_Koords[i][0][1] = y;
            Ellips_Koords[i][0][2] = z;
            double gamma = DoubleRand(1, 0), gamma_1_probeg = DoubleRand(1, 0);
            double gamma_2 = DoubleRand(1, 0);
            double x_new = x + Probeg(gamma_1_probeg, Start_energy) * sin(pi * gamma) * cos(2 * pi * gamma_2);
            double y_new = y + Probeg(gamma_1_probeg, Start_energy) * sin(pi * gamma) * sin(2 * pi * gamma_2);
            double z_new = z + Probeg(gamma_1_probeg, Start_energy) * cos(pi * gamma);
            if (abs(x_new) < fun_cirk(y_new, b) and abs(y_new) < fun_cirk(x_new, b) and z_new > 0 and z_new < high_cill) {
                Ellips_Koords[i][1][0] = x_new;
                Ellips_Koords[i][1][1] = y_new;
                Ellips_Koords[i][1][2] = z_new;
				double W = 1;
				int j = 0;
                while (alpha > 0.1/0.511) {
                    if (abs(Ellips_Koords[i][j + 1][0]) < fun_cirk(Ellips_Koords[i][j + 1][1], b)
                    and abs(Ellips_Koords[i][j + 1][1]) < fun_cirk(Ellips_Koords[i][j + 1][0], b)
                        and Ellips_Koords[i][j + 1][2] > 0 and Ellips_Koords[i][j + 1][2] < high_cill) {
                        double gamma_2_probeg = DoubleRand(1, 0);
                        double gamma_3 = DoubleRand(1, 0), gamma_4 = DoubleRand(1, 0);
                        if (kompron_scattering(alpha * 0.511) / total_scat(alpha * 0.511) > gamma_3) {
                            double alpha_sh = alpha;
                            double rand_1 = DoubleRand(1, 0), rand_2 = DoubleRand(1, 0);
                            alpha = alpha_sh * (1 + 2 * alpha_sh * rand_1) / (1 + 2 * alpha_sh);
                            double p = alpha / alpha_sh + alpha_sh / alpha +
                                       (1 / alpha_sh - 1 / alpha) * (2 + 1 / alpha_sh - 1 / alpha);
                            while (rand_2 * (1 + 2 * alpha_sh + 1 / (1 + 2 * alpha_sh)) >= p) {
                                rand_1 = DoubleRand(1, 0), rand_2 = DoubleRand(1, 0);
                                alpha = alpha_sh * (1 + 2 * alpha_sh * rand_1) / (1 + 2 * alpha_sh);
                                p = alpha / alpha_sh + alpha_sh / alpha +
                                    (1 / alpha_sh - 1 / alpha) * (2 + 1 / alpha_sh - 1 / alpha);
                            }
                            double minus_or_nor = pow(-1, rand());
                            Ellips_Koords[i][j+2][0] =
                                    Ellips_Koords[i][j+1][0] + Probeg(gamma_2_probeg, alpha) * minus_or_nor *
                                                             sin(acos(1 - 1 / alpha + 1 / alpha_sh)) *
                                                             cos(2 * pi * gamma_4);
                            Ellips_Koords[i][j + 2][1] =
                                    Ellips_Koords[i][j + 1][1] + Probeg(gamma_2_probeg, alpha) * minus_or_nor *
                                                                 sin(acos(1 - 1 / alpha + 1 / alpha_sh)) *
                                                                 sin(2 * pi * gamma_4);
                            Ellips_Koords[i][j + 2][2] = Ellips_Koords[i][j + 1][2] +
                                                         Probeg(gamma_2_probeg, alpha) * (1 - 1 / alpha + 1 / alpha_sh);
                            if (abs(Ellips_Koords[i][j + 2][0]) < fun_cirk(Ellips_Koords[i][j + 2][1], b)
                                and abs(Ellips_Koords[i][j + 2][1]) < fun_cirk(Ellips_Koords[i][j + 2][0], b)
                                and Ellips_Koords[i][j + 2][2] > 0 and Ellips_Koords[i][j + 2][2] < high_cill) {
                                W = W*Scat_diff(alpha, alpha_sh)/Scat_int(alpha);
                                Scat_dist[j+1][0]=alpha*0.511;
                                Scat_dist[j+1][1]=W*gamma_2_probeg/(rasst_d(Ellips_Koords[i][j + 2][0],
                                        Ellips_Koords[i][j + 2][1],Ellips_Koords[i][j + 2][2]));
                                Scat_dist[j+1][2]=W*gamma_2_probeg/(rasst_d(Ellips_Koords[i][j + 2][0],
                                        Ellips_Koords[i][j + 2][1],high_cill/4 - Ellips_Koords[i][j + 2][2]));
                                Scat_dist[j+1][3]=W*gamma_2_probeg/(rasst_d(Ellips_Koords[i][j + 2][0],
                                        Ellips_Koords[i][j + 2][1],high_cill/2 - Ellips_Koords[i][j + 2][2]));
                                Scat_dist[j+1][4]=W*gamma_2_probeg/(rasst_d(Ellips_Koords[i][j + 2][0],
                                        Ellips_Koords[i][j + 2][1],high_cill*3/4 - Ellips_Koords[i][j + 2][2]));
                                Scat_dist[j+1][5]=W*gamma_2_probeg/(rasst_d(Ellips_Koords[i][j + 2][0],
                                        Ellips_Koords[i][j + 2][1],high_cill-Ellips_Koords[i][j + 2][2]));

                                for(int y=0;y<15;++y){
                                    if (Scat_dist[j+1][y]!=0.0)
                                        fout1 << Scat_dist[j + 1][y] << "\t";
                                }
                                fout1<<endl;
                                j++;
                                }
                        } else {
                            i = i-1;
                            break;
                        }

                    } else {
                        i = i-1;
                        break;
                    }
                }
                i = i + 1;
            }
        }
    }
    ofstream fout("data_elips.txt");
    for(int y=0;y<Ellips_Koords.size()-1;++y){
        for(int x=0;x<Ellips_Koords[y].size();++x){
            for(int z=0;z<Ellips_Koords[y][x].size();++z){
                if (Ellips_Koords[y][x][z]!=0)
                    fout<<Ellips_Koords[y][x][z]<<" ";
            }
        }
        if (y<=Ellips_Koords.size()-1)
        fout<<"|";
    }
    fout.close(); // закрытие файла
    return 0;
}

int main (){
    double a = 10; //Parametrs for ellipsoid
    double b = 30;
    double c = 1e-6;
    double high = 20;
    double Start_energy = 3.0;
    int N = 100000;
    srand(time(0));
    Monte_karlo1(a, b, c, high, N, Start_energy);
}
\end{verbatim}
\normalsize

\subsection{Программа в python}
\begin{verbatim}
import pandas as pd
import seaborn as sea
sea.set()
import matplotlib.pyplot as plt

def main():
    subprocess.call("FirstWork.exe", shell=True)

    d11 = open("data_elips1.txt").read()
    d11 = d11.split("\n")
    r=0
    dn=[]
    print(len(d11))
    while(r<len(d11)-1):
        i=0
        d1_new= d11[r].split("\t")
        d2 = []
        for i in range(len(d1_new)-1):
            if (float(d1_new[i])!=0.0):
                d2.append(float(d1_new[i]))
        dn.append(d2)
        r+=1

    dn = pd.DataFrame(dn)
    dn = dn.apply(lambda x: pd.Series(x.dropna().values))
    dn = dn.sort_values(by=[0])
    fig = plt.figure()

    ax1 = fig.add_subplot(2, 2, 1)
    ax2 = fig.add_subplot(2, 2, 2)
    ax3 = fig.add_subplot(2, 2, 3)
    ax4 = fig.add_subplot(2, 2, 4)

    ax1.set(title="h=0", ylabel="\\nu")
    ax2.set(title="h=7.5", ylabel="\\nu")
    ax3.set(title="h=15", ylabel="\\nu", xlabel="E, MeV")
    ax4.set(title="h=30", ylabel="\\nu", xlabel="E, MeV")

    ax1.plot(dn[0].tolist(), dn[6].tolist(), "-", color='g')
    ax2.plot(dn[0].tolist(), dn[7].tolist(), "-", color='r')
    ax3.plot(dn[0].tolist(), dn[8].tolist(), "-", color='b')
    ax4.plot(dn[0].tolist(), dn[10].tolist(), "-", color='y')

    plt.suptitle('symmetry axes: side of the cylinder')
    #plt.suptitle('symmetry axes: center of the cylinder')
    plt.show()

if __name__ == "__main__":
    main()
    
    
\end{verbatim}

<<<<<<< HEAD
769694415:AAHJOE20UmAp37pDIT7Y8LXplXVphen9n_I
dbdb805d-be57-4fe5-9436-2f83acf41d1e
=======


>>>>>>> d082c9b27f01d1aed7a45394379fe92a1fd38c33
\end{document}